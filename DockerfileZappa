FROM lambci/lambda:build-python3.6

WORKDIR /code
ENTRYPOINT ["/entrypoint.sh"]
RUN printf '#!/bin/sh\nsource /var/venv/bin/activate\nexec "$@"' > /entrypoint.sh && \
  chmod 700 /entrypoint.sh

ADD requirements.txt /code/requirements.txt
RUN virtualenv /var/venv && \
  source /var/venv/bin/activate && \
  pip install -r /code/requirements.txt

ADD apps /code/apps
ADD tesselo /code/tesselo
ADD manage.py /code/manage.py
ADD zappa_settings.json /code/zappa_settings.json
